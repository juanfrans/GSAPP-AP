<!DOCTYPE html>

<!-- This is a comment in html -->

<html lang="en">
	<head>
		<meta charset="utf-8">
		<title>Citi Bike Imbalance</title>
		<script type="text/javascript" src="jquery-1.7.2.min.js"></script>
		<script type="text/javascript" src="jquery.tipsy.js"></script>
		<script type="text/javascript" src="d3/d3.v3.js"></script>
		<link rel="stylesheet" type="text/css" href="style.css">
		<link rel="stylesheet" type="text/css" href="tipsy.css">

	</head>
	<body>
		<h1>Citi Bike Imbalances</h1>
		<p>This is a test for a new page for this project. This is not the official project page, just testing ground for a new D3 version of this project. To see the offical page for this project go <a href="http://juanfrans.com/CITI-BIKE-STATION-IMBALANCES">here</a> or <a href="http://spatialinformationdesignlab.org/projects.php?id=320">here</a>.</p>

		<h2>Test</h2>
		<p>This is a project we are currently working on at the <a href="http://spatialinformationdesignlab.org"> Spatial Information Design Lab</a>.</p>


        <div id="lineChart"></div>
        <div id="chart"></div>
        <script type="text/javascript">

            var margin = {top:20, right:20, bottom:30, left:50},
                widthLineChart = 800 - margin.left - margin.right,
                heightLineChart = 500 - margin.top - margin.bottom;

            var parseDate = d3.time.format("%x").parse;

            var x = d3.time.scale()
                .range([0, widthLineChart]);

            var y = d3.scale.linear()
                .range([heightLineChart,0]);

            var xAxis = d3.svg.axis()
                .scale(x)
                .orient("bottom");

            var yAxis = d3.svg.axis()
                .scale(y)
                .orient("left")

            var line = d3.svg.line()
                .x(function(d) { return x(d.date); })
                .y(function(d) { return y(d.total); });

            var lineChartDiv = d3.select("#lineChart"),
                lineChartSVG = lineChartDiv.append('svg')
                .attr('width', widthLineChart + margin.left + margin.right)
                .attr('height', heightLineChart + margin.top + margin.bottom)
                .append("g")
                .attr("transform", "translate(" + margin.left + "," + margin.top +")");

            d3.csv("data/Overall_Daily_Activity.csv", function(error, data){
                //console.log("this is the data... " + data)
                data.forEach(function(d){
                    d.date = parseDate(d.date);
                    //console.log("Date = " + d.date);
                    d.total = + d.total;
                    //console.log("Total = " + d.total)
                });

            x.domain(d3.extent(data, function(d) {return d.date;}));
            y.domain(d3.extent(data, function(d) {return d.total;}));

            lineChartSVG.append("g")
                .attr("class", "x axis")
                .attr("transform", "translate(0," + heightLineChart + ")")
                .call(xAxis);

            lineChartSVG.append("g")
                .attr("class", "y axis")
                .call(yAxis)
                .append("text")
                .attr("transform", "rotate(-90)")
                .attr("y", 6)
                .attr("dy", ".71em")
                .style("text-anchor", "end")
                .text("Total Rides");

            lineChartSVG.append("path")
                .datum(data)
                .attr("class", "line")
                .attr("d", line);

            });


        </script>


        <script type="text/javascript">

            var data = [];

            var color_scale = d3.scale.linear()
                .domain([0, 200])
                .range([0.05, 1]);


            var width = 670,
                height = 1100,
                div = d3.select('#chart'),
                svg = div.append('svg')
                .attr('width', width)
                .attr('height', height),
                rw = 24,
                rh = 2;

            d3.text("data/Oct_Balance_Hour.csv", function(master_data){
                dataset = d3.csv.parseRows(master_data);
                for (var k = 1; k < dataset.length; k += 1) { //the station list
                    var data2 =[]
                    for (var j = 3; j<27; j++){
                        data2.push(dataset[k][j]);
                    }
                    data.push(data2); // the number of entries per station
                }
                //console.log(data);

                // Create a group for each row in the data matrix and
                // translate the group vertically
                var grp = svg.selectAll('g')
                .data(data)
                .enter()
                .append('g')
                .attr('transform', function(d, i) {
                    return 'translate(0, ' + 3 * i + ')';
                });

                // For each group, create a set of rectangles and bind 
                // them to the inner array (the inner array is already
                // binded to the group)
                grp.selectAll('rect')
                .data(function(d) { return d; })
                .enter()
                .append('rect')
                .attr('x', function(d, i) { return 25 * i; })
                .attr('width', rw)
                .attr('height', rh)
                .attr('fill', function(d, i){
                    //console.log(d+ "=d");
                    //console.log(i+"=i");
                    if (d <= 0){
                        return "rgb(255, 102, 0)"
                    }
                    else{
                        return "rgb(0, 255, 255)"
                    };
                })
                .attr('opacity', function(d,i){
                    return color_scale(Math.abs(d))
                });

                $('rect').tipsy({
                    gravity: 'w',
        	        html: true,
        	        delayIn: 500,
        	        title: function(){
                        var d = this.__data__;
                        return d;
                    }
                })

            });
        </script>
	</body>
</html>